# RFC v1 Implementation Notes

> ⚠️ Шаблон заполняется на русском языке. Комментарии внутри таблиц следует очищать по мере перехода к рабочей эксплуатации.

## 1. Сводка статуса по этапам

| Этап | Диапазон задач (см. [план параллельных лотерей](./lottery_parallel_plan.md)) | Статус \(Not Started / In Progress / Done\) | Основные комментарии | Дата обновления |
|------|--------------------------------------------------------------------------------|----------------------------------------------|----------------------|-----------------|
| 0    | Подготовка архитектуры, согласование RFC, публикация книги проекта             | Done               | Архитектура согласована, книга проекта опубликована | 2025-11-09 |
| 1    | Фундаментальные артефакты: схемы ресурсов, событий, view и документации        | Done               | Сформированы ключевые модули (`registry`, `sales`, `draw`, `payouts`, `automation`, `price_feed`), добавлены view `get_lottery`/`list_active`/`list_by_*`, обновлены unit-тесты жизненного цикла и документация | 2025-11-10 |
| 2    | Миграции, capabilities, тестовая инфраструктура и мониторинг VRF-депозита      | Done               | Завершены `winner_tests`, dual-write контроль и проверки VRF-депозита; подготовлены миграционные инструменты и Prover-спеки | 2025-11-12 |
| 3    | Реализация ядра lottery_multi, партнёрских ограничений и премиальных фич       | Done               | Ядро lottery_multi завершено: батчи `compute_winners_admin`/`record_payout_batch_admin` обеспечивают дедупликацию и события выплат, поддержаны партнёрские/премиальные capability и on-chain рефанды, а тесты подтверждают финализацию и отмены. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/payouts.move†L65-L218】【F:SupraLottery/supra/move_workspace/lottery_multi/sources/roles.move†L41-L171】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/payouts_tests.move†L120-L377】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/views_tests.move†L154-L215】 | 2025-12-09 |
| 4    | Расширение пользовательских сервисов, локализация, поддержка партнёров         | Done               | История и миграции полностью готовы: `history` публикует события импорта/отката и view, dual-write управляется через `legacy_bridge`, CLI `history_backfill.sh` покрывает dry-run/import/rollback/classify, а тесты закрывают жизненный цикл. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/history.move†L60-L188】【F:SupraLottery/supra/move_workspace/lottery_multi/sources/legacy_bridge.move†L18-L216】【F:supra/scripts/history_backfill.sh†L1-L80】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/history_migration_tests.move†L10-L63】 | 2025-12-09 |
| 5    | Наблюдаемость, автоматизация, прайс-фиды, очистка хранилища                    | Done               | Наблюдаемость и автоматика развернуты: AutomationBot управляет таймлоками и событиями, `views::status_overview` и CLI отражают состояние, прайс-фид поддерживает клампы/фолбэки, а runbook/monitoring/incident лог обновлены; агрегаты `refund_active`/`refund_batch_pending`/`refund_sla_breach` фиксируют SLA рефандов. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/automation.move†L1-L208】【F:SupraLottery/supra/move_workspace/lottery_multi/sources/views.move†L201-L356】【F:SupraLottery/supra/move_workspace/lottery_multi/sources/price_feed.move†L1-L176】【F:supra/scripts/automation_status.sh†L1-L37】【F:docs/handbook/operations/monitoring.md†L1-L70】【F:supra/scripts/refund_control.sh†L1-L92】 | 2025-12-11 |
| 6    | Пострелизная стабилизация, баг-баунти, расширенные тесты и документация        | Done               | Пострелизные регламенты оформлены: runbook, мониторинг, статусная страница и журнал увязаны с процедурами поддержки и ретроспективами; программа баг-баунти финализирована с диапазонами наград и процессом выплат. 【F:docs/handbook/operations/runbooks.md†L1-L67】【F:docs/handbook/operations/post_release_support.md†L1-L36】【F:docs/handbook/operations/bug_bounty.md†L1-L114】【F:docs/handbook/operations/incident_log.md†L1-L31】 | 2025-12-10 |
| 7    | Governance/API (перенесено на позднюю фазу)                                    | Not Started        | Запустим после завершения фронтенда и базовых функций новых контрактов, чтобы зафиксировать окончательные интерфейсы | _YYYY-MM-DD_ |

## 2. Прогресс по модулям Move

| Модуль | Ключевые обязанности | Текущее состояние | Ответственный | Последний апдейт |
|--------|----------------------|-------------------|---------------|------------------|
| `registry` | Жизненный цикл лотерей, статусы, идентификаторы | Done | Реестр фиксирует конфигурацию, снимки и отмены с событиями `LotteryCanceledEvent`, а тесты подтверждают блокировки тегов и выдачу причин через view. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/registry.move†L19-L190】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/config_tests.move†L102-L142】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/views_tests.move†L154-L215】 | 2025-12-09 |
| `sales` | Выпуск билетов, лимиты, анти-DoS | Done | Продажи управляют чанками билетов, снапшотом и учётом выплат, а тесты покрывают rate-limit, grace-window и прогресс рефандов. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/sales.move†L300-L505】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/sales_tests.move†L10-L94】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/payouts_tests.move†L166-L190】 | 2025-12-09 |
| `draw` | VRF-запросы, обработка retry, анти-bias | Done | VRF запросы формируют payload с checksum, контролируют retry-окна, поддерживают политику `vrf_retry_policy` (fixed/exponential/manual) и лимит `MAX_VRF_ATTEMPTS = 5`: при исчерпании попыток `request_draw_admin` инициирует отмену/рефанд, а ручные повторы требуют `schedule_manual_retry_admin`. Тесты подтверждают экспоненциальные задержки и ручные дедлайны, Prover-спека синхронизирована с политикой. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/draw.move†L21-L250】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/draw_tests.move†L18-L347】【F:SupraLottery/supra/move_workspace/lottery_multi/spec/draw.move†L1-L151】 | 2025-12-15 |
| `payouts` | Подсчёт победителей, батчи выплат, идемпотентность | Done | Батчи победителей и выплат ведут контроль хэшей и раундов, Prover-спека гарантирует рост `payout_round`, тесты закрывают финализацию, партнёрские выплаты и рефанды. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/payouts.move†L65-L218】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/payouts_tests.move†L300-L377】【F:SupraLottery/supra/move_workspace/lottery_multi/spec/payouts.move†L26-L56】 | 2025-12-09 |
| `economics` | Резервы, распределение долей, джекпот | Done | Модуль рассчитывает распределения и контролирует лимиты резервов и джекпота, что подтверждено Prover-спекой и проверками учёта при выплатах. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/economics.move†L7-L125】【F:SupraLottery/supra/move_workspace/lottery_multi/spec/economics.move†L1-L56】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/payouts_tests.move†L210-L216】 | 2025-12-09 |
| `history` | Архивы, dual-write, снапшоты | Done | История публикует события сводок, поддерживает импорт/откат и view, а интеграционные тесты закрывают dry-run и классификацию legacy. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/history.move†L60-L188】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/history_migration_tests.move†L10-L63】 | 2025-12-09 |
| `legacy_bridge` | Dual-write контроль, ожидание хэшей | Done | Dual-write контролирует ожидания, зеркалирование и события, тесты проверяют mismatch, pending и mirror в `history_bridge`. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/legacy_bridge.move†L18-L216】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/history_dual_write_tests.move†L13-L120】 | 2025-12-09 |
| `views` | Публичные API, фильтры, JSON-схемы | Done | View агрегируют статусы, VRF и рефанды, включая AutomationBot, а тесты подтверждают статусную сводку, SLA возвратов и мониторинг отмен/возвратов. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/views.move†L201-L356】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/views_tests.move†L111-L276】 | 2025-12-11 |
| `roles` | Capabilities, партнёры, премиальные подписки | Done | RoleStore управляет капабилити с событиями выдачи/отзыва, тесты фиксируют бюджеты, таймлоки и очистку истёкших записей. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/roles.move†L41-L183】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/roles_tests.move†L10-L123】 | 2025-12-09 |
| `tags` | Классификаторы, фильтрация, маски | Done | Валидатор типов и масок ограничивает неизвестные биты и бюджет тегов, проверяется юнит-тестами капабилити. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/tags.move†L1-L55】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/roles_tests.move†L53-L58】 | 2025-12-09 |
| `price_feed` | Оракулы SUPRA/USD и прочие активы | Done | Реестр прайс-фидов поддерживает fallback, clamp и очистку, а тесты проверяют регистрацию, устаревание и ручное снятие клампа. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/price_feed.move†L1-L176】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/price_feed_tests.move†L10-L114】 | 2025-12-09 |
| `feature_switch` | Управление доступом к функциям | Done | Реестр режимов хранит devnet override и настройки режимов, обеспечивая проверки доступности фич. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/feature_switch.move†L1-L105】 | 2025-12-09 |
| `automation` | AutomationBot, dry-run, репутация | Done | AutomationRegistry управляет ботами, событиями и таймлоками; тесты подтверждают pending, лимиты, сбросы и минимальный таймлок 900 секунд для чувствительных действий. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/automation.move†L1-L320】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/automation_tests.move†L10-L103】 | 2025-12-09 |

## 3. Контроль ключевых инвариантов

| Инвариант | Инструменты проверки | Текущий статус | Комментарий |
|-----------|----------------------|----------------|-------------|
| `snapshot_hash` неизменен после `Closing` | Move Prover, unit-тесты | Done | Prover-спеки draw/payouts фиксируют неизменность снапшота, а тесты `draw_tests` проверяют финализационный снимок. 【F:SupraLottery/supra/move_workspace/lottery_multi/spec/draw.move†L10-L107】【F:SupraLottery/supra/move_workspace/lottery_multi/spec/payouts.move†L26-L56】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/draw_tests.move†L75-L92】
| `payout_round` строго возрастает | Move Prover | Done | `spec/payouts.move` гарантирует рост раунда при батчах выплат, что подтверждают интеграционные тесты финализации. 【F:SupraLottery/supra/move_workspace/lottery_multi/spec/payouts.move†L26-L56】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/payouts_tests.move†L300-L355】
| `allocated >= paid` во всех пулах | Move Prover, unit-тесты | Done | Инварианты экономики фиксируют распределения и ограничения резервов, а тесты выплат сверяют агрегаты `total_prize_paid`/`total_operations_paid`. 【F:SupraLottery/supra/move_workspace/lottery_multi/spec/economics.move†L1-L56】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/payouts_tests.move†L324-L336】
| `jackpot_allowance_token` не увеличивается | Move Prover | Done | Спека экономики ограничивает изменение токена, а реализация применяет проверки при установке и расходовании. 【F:SupraLottery/supra/move_workspace/lottery_multi/spec/economics.move†L45-L58】【F:SupraLottery/supra/move_workspace/lottery_multi/sources/economics.move†L87-L105】
| Детерминированный выбор победителей | Differential / property tests | Done | Вычисление победителей детерминировано по хэшам батчей, что проверяют тесты `winner_tests` и `payouts` хранящие checksum. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/payouts.move†L135-L213】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/winner_tests.move†L20-L121】
| Dual-write архива остаётся консистентным | Unit-тесты, интеграционные тесты | Done | Dual-write контролируется событиями и ожиданиями, тесты покрывают импорт, зеркалирование и pending-очередь. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/legacy_bridge.move†L18-L216】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/history_dual_write_tests.move†L13-L120】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/history_migration_tests.move†L10-L63】

## 4. Архив и миграции

- **Legacy backfill**: импорт и откат legacy-сводок выполняются через `history::{import_legacy_summary_admin, rollback_legacy_summary_admin, update_legacy_classification_admin}`, при импорте очищается ожидание dual-write (`legacy_bridge::notify_summary_written`), а CLI `supra/scripts/history_backfill.sh` с Python-драйвером поддерживает JSON-вывод для внешних пайплайнов (`--json`, `--json-output`). Сценарии покрыты интеграционными и pytest-тестами. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/history.move†L308-L316】【F:supra/scripts/history_backfill.sh†L1-L82】【F:supra/tools/history_backfill_dry_run.py†L1-L137】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/history_migration_tests.move†L10-L78】【F:tests/test_history_backfill_dry_run.py†L1-L129】
- **Dual-write мониторинг**: включены события `ArchiveDualWriteStarted/Completed`, view `dual_write_status`/`pending_expected_hashes` и CLI `supra/scripts/dual_write_control.sh`; тесты покрывают mismatch, pending-очередь и зеркалирование в `history_bridge`. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/legacy_bridge.move†L18-L216】【F:supra/scripts/dual_write_control.sh†L1-L155】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/history_dual_write_tests.move†L13-L120】
- **Состояние миграции `LotteryHistoryArchive`**: схема `ArchiveSummaryV1`, runbook рефандов и тесты `payouts_tests` покрывают сценарий `cancel → refund → archive`, включая интеграционный путь `force_cancel_refund_flow_records_history`; документация обновлена в `operations/refund.md`, а `status_overview` дополнен контролем SLA. 【F:SupraLottery/supra/move_workspace/lottery_multi/tests/payouts_tests.move†L133-L233】【F:docs/handbook/operations/refund.md†L1-L120】

## 5. Фронтенд и API

| Компонент | Зависимости от on-chain | Статус | Комментарии |
|-----------|-------------------------|--------|-------------|
| Раздел «История» | `views::list_by_primary_type`, `get_lottery_status`, JSON Schema v1 | In Progress | Тесты `views_tests` подтверждают фильтры/пагинацию; подготовлена схема `lottery_multi_views.schema.json`, пример `lottery_multi_view_samples.json` и Python-валидатор схемы; добавлено агрегированное представление `status_overview` для статусной страницы |
| Админ-конструктор | `views::validate_config`, таблица тегов, FeatureSwitch dev override | Not Started |  |
| Партнёрский мастер | Preset API, квоты песочницы, allowed tags/types | Not Started |  |
| API/индексатор | Dual-write архив, события v1 с `event_version` | Not Started | Запланировано после реализации фронтенда и базовых функций контрактов; текущая схема view зафиксирована, но интеграция с индексатором откладывается | 

## 6. Операционные регламенты

- **VRF-депозит**: 2025-11-11 — runbook [operations/vrf_deposit.md](../handbook/operations/vrf_deposit.md) в рабочем режиме; Ops-инженер Н. Иванова отслеживает `effective_balance` и `required_minimum` через дашборд Grafana. Автономное возобновление запросов подключено через AutomationBot: `record_snapshot_automation` требует dry-run и timelock, публикует `AutomationTick`/`AutomationDryRunPlanned`, а процедура фиксируется в [incident_log.md](../handbook/operations/incident_log.md) через `supra/scripts/incident_log.sh`.
- **AutomationBot**: последняя ротация ключей — 2025-11-08; счётчик успешных задач 24/24, предупреждений нет. Runbook дополнили сценарием снапшота VRF с dry-run и timelock, тесты `vrf_deposit_tests` подтверждают блокировку без pending и до наступления таймлока, а view `views::list_automation_bots`/`get_automation_bot` отображают новое действие.
- **Automation timelock**: 2025-12-16 — для действий `ACTION_UNPAUSE`/`ACTION_PAYOUT_BATCH`/`ACTION_CANCEL` введён минимальный таймлок 900 секунд, проверяемый в `automation_tests` и контролируемый в runbook/monitoring/status page. 【F:SupraLottery/supra/move_workspace/lottery_multi/sources/automation.move†L20-L27】【F:SupraLottery/supra/move_workspace/lottery_multi/tests/automation_tests.move†L63-L103】【F:docs/handbook/operations/runbooks.md†L5-L55】【F:docs/handbook/operations/monitoring.md†L16-L50】【F:docs/handbook/operations/status_page.md†L31-L64】
- **Рефанд-процедуры**: SLA 24 часа, контрольный прогон runbook завершён 2025-11-07; on-chain батчи доступны через `payouts::force_refund_batch_admin`/`RefundBatchEvent`, прогресс мониторится `views::get_refund_progress` (обёртка над `sales::refund_progress`), причины отмен доступны через `views::get_cancellation`. Интеграционный тест `force_cancel_refund_flow_records_history` закрывает сценарий «force_cancel → refund → archive», CLI `refund_control.sh` поддерживает флаг `--dry-run` для проверки пайплайна без доступа к Supra CLI, а `accounting_check.sh` предоставляет сравнение агрегатов `total_*` между `sales::accounting_snapshot` и `LotterySummary`; запуск полного цикла на стейджинге запланирован после восстановления бинаря.
- **Прайс-фид**: `staleness_window` = 300 c, кламп фиксируется событиями `PriceFeedClampEvent`/`PriceFeedClampClearedEvent`, fallback переключается через `PriceFeedFallbackEvent`. Проверка 2025-11-26 подтвердила отсутствие активных клампов и fallback; runbook требует ручного подтверждения `clear_clamp` после расследования скачка.
- **Supra CLI**: 2025-11-12 — CLI установлен на staging, добавлен скрипт `supra/scripts/run_move_tests.sh` (валидирует наличие бинаря/версии) и runbook [operations/supra_cli.md](../handbook/operations/supra_cli.md). Smoke-прогон `aptos move test` включён в release checklist, версии CLI фиксируются в `incident_log.md`.
- **Баг-баунти**: финальная версия [operations/bug_bounty.md](../handbook/operations/bug_bounty.md) включает базовые и верхние границы наград, матрицу охвата компонентов, правила приёма отчётов и процесс выплат; согласование с отделом безопасности проведено 2025-12-10, запись добавлена в `incident_log.md`.

## 7. Журнал решений (RFC Notes)

| Дата | Решение | Область (модуль/процесс) | Следующие действия |
|------|---------|--------------------------|--------------------|
| 2025-11-16 | Включить события `ArchiveDualWriteStarted/Completed`, view `dual_write_status` и Supra CLI-скрипт для управления dual-write | `legacy_bridge`, операции миграции | Подготовить интеграционные тесты dual-write и dry-run миграции |
| 2025-11-17 | Включить зеркальную запись `mirror_summary_to_legacy` и модуль `history_bridge`, расширить Supra CLI командами `enable/disable-mirror`, `mirror` | `legacy_bridge`, `history`, операции миграции | Проверить dry-run миграции с использованием `history_bridge::get_summary` |
| 2025-11-18 | Зафиксировать лимиты AutomationBot через тесты `ensure_action` и обновить runbook наблюдаемости | `automation`, операции | Подготовить интеграционные проверки CLI и графики мониторинга `failure_count` |
| 2025-11-19 | Подготовить JSON Schema ответов view и покрыть фильтры UI тестами `views_tests` | `views`, фронтенд/API | Согласовать схему с фронтендом и индексаторами, добавить smoke-тесты REST |
| 2025-11-20 | Зафиксировать пример ответов view и Python-проверку JSON Schema | `views`, фронтенд/API | Подключить схему и пример в smoke-тесты REST и пайплайн индексатора |
| 2025-11-21 | Ввести релизный чек-лист, журнал операций и документ мониторинга | Операции, AutomationBot, dual-write | Интегрировать заполнение `incident_log.md` в Ops-процессы и согласовать баг-баунти вознаграждения |
| 2025-11-22 | Усилить Move Prover-спеки модуля `draw`: контроль retry, статуса `FULFILLED` и финализационного снимка | `draw`, VRF жизненный цикл | Провести прогон Move Prover после установки CLI, дополнить интеграционные тесты retry-стратегий |
| 2025-12-13 | Ввести автоматическую отмену после `MAX_VRF_ATTEMPTS = 5` и обновить тесты/spec | `draw`, `registry`, VRF операции | Подготовить сценарии AutomationBot для стратегии manual (dry-run + `schedule_manual_retry_admin`) и обновить мониторинг ожиданий |
| 2025-11-23 | Добавить view `pending_expected_hashes` и CLI-команду `pending` для контроля dual-write ожиданий | `legacy_bridge`, операции миграции | Привязать список ожиданий к процедурам backfill и автоматическому журналу dual-write |
| 2025-11-24 | Зафиксировать анти-DoS тесты продаж и многослотные партнёрские выплаты (`sales_tests`, `payouts_tests`) | `sales`, `payouts`, экономика | После установки CLI прогнать `aptos move test` для новых сценариев и обновить runbook по мониторингу rate-limit событий |
| 2025-11-25 | Добавить импорт/откат наследуемых сводок (`history_migration_tests`, `history_backfill.sh`) | `history`, `legacy_bridge`, операции миграции | Связать CLI с внешним backfill-скриптом, задокументировать dry-run и журнал ручных операций |
| 2025-11-28 | Включить Python-dry-run для `history_backfill.sh` и pytest-покрытие `tests/test_history_backfill_dry_run.py` | `history`, операции миграции | Интегрировать dry-run в внешние backfill-утилиты и автоматическое заполнение `incident_log.md` |
| 2025-11-30 | Автоматизировать ведение журнала операций через CLI и Python-модуль | Операции, документация | Подключить `supra/scripts/incident_log.sh` к внешним DevOps-плейбукам и интеграционным тестам миграций |
| 2025-11-26 | Ввести ручное снятие клампа (`clear_clamp`), события `PriceFeedClampClearedEvent`, тесты `price_feed_tests` и спецификацию `spec/price_feed.move`; опубликовать справочник `price_feeds.md` | `price_feed`, наблюдаемость | Интегрировать проверку событий клампа в мониторинг и добавить сценарий `clear_clamp` в release checklist |
| 2025-12-01 | Добавить пострелизные процедуры (`operations/post_release_support.md`, `operations/postmortems.md`), обновить runbook, мониторинг, статусную страницу и релизный чек-лист | Операции, пострелизная поддержка | Провести пилотную ретроспективу и синхронизировать roadmap этапа 6 |
| 2025-12-02 | Зафиксировать матрицу выдачи capability и политику тегов (`roles.md`, `tags_policy.md`) | Роли, классификаторы | Подключить контроль мультисиг/таймлоков в DevOps и автоматическую проверку масок в CI |
| 2025-12-03 | Перевести Dashboard на `status_overview` через хук `useLotteryMultiViews`, показывая активные розыгрыши и бэклог VRF/выплат | Фронтенд, статусная страница | Добавить smoke-тест внешнего REST-клиента и связать проверку `/lottery-multi/views` с мониторингом |
| 2025-12-04 | Включить on-chain рефанды: `sales::record_refund_batch`, `payouts::force_refund_batch_admin`, событие `RefundBatchEvent` и тесты `payouts_tests::{refund_batch_records_progress, refund_requires_canceled_status, refund_cannot_exceed_tickets}` | `sales`, `payouts`, операции рефанда | Подготовить интеграционный сценарий «cancel → refund → finalize архив» и обновить мониторинг статусной страницы |
| 2025-12-05 | Экспортировать причины отмен и прогресс рефандов через view `views::{get_cancellation, get_refund_progress}`, покрыв сценарий `cancel → refund` тестом `views_tests::cancellation_and_refund_views` | `registry`, `sales`, `views`, операции рефанда | Синхронизировать JSON Schema и статусную страницу с новыми полями, обновить мониторинг возвратов |
| 2025-12-06 | Ввести CLI `supra/scripts/refund_control.sh` для сценариев `cancel/batch/progress/archive` и задокументировать его в runbook/release checklist | Операции, `registry`, `payouts`, `views` | Согласовать dry-run скрипта с DevOps, добавить проверки CLI в пайплайн |
| 2025-12-07 | Добавить view `list_automation_bots`/`get_automation_bot`, публичные хелперы `automation_status`/`automation_operators`, обновить JSON Schema v1.0.3 и статусную страницу | `automation`, `views`, операции | Включить интеграционные проверки AutomationBot CLI и добавить наблюдение pending-действий в мониторинг |
| 2025-12-11 | Обновить JSON Schema до v1.0.4 и расширить `status_overview` полями рефандов (`refund_active`, `refund_batch_pending`, `refund_sla_breach`); добавить тест `status_overview_tracks_refund_metrics` | `views`, операции | Синхронизировать документацию (status_page, monitoring, refund.md) и примеры JSON |
| 2025-12-15 | Обновить JSON Schema до v1.0.5 и добавить `vrf_retry_policy` в `LotteryConfig`; пример ответов фиксирует стратегию `retry_strategy = 2` | `views`, VRF | Отразить стратегию manual в статусной странице и инструкциях AutomationBot |
| 2025-12-08 | Ввести CLI `supra/scripts/automation_status.sh` и обновить runbook/monitoring/status page для контроля AutomationBot через view `list_automation_bots`/`get_automation_bot` | `automation`, операции, мониторинг | Прогнать dry-run CLI на стейджинге и подключить вывод к журналу операций |

> Обновляя таблицы, не забывайте ссылаться на коммиты, PR или внешние документы. При необходимости расширяйте разделы, но сохраняйте структуру шаблона для единообразия.
