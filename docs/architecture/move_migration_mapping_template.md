# Таблица соответствий «старые → новые» для миграции SupraLottery

Документ служит рабочим шаблоном, который связывает существующие on-chain структуры старых пакетов с целевыми сущностями новой архитектуры (`lottery_data`, `lottery_engine`, `lottery_gateway` и др.). Таблица заполняется вручную на основе фактического состояния кода и отчёта из `docs/architecture/move_struct_inventory.md`. Пакет `lottery_gateway` продолжает текущий `lottery_hub`, а `lottery_vrf_gateway` наследует `vrf_hub`, поэтому в строках для этих подсистем указываем оба имени до момента переименования на testnet.

> Актуально заполненная версия размещена в `docs/architecture/move_migration_mapping.md`. Используйте её как основной источник, а данный файл — как шаблон для новых подсекций или дополнительных пакетов.

## 1. Как пользоваться шаблоном
- Заполняем строку для **каждого ресурса/структуры**, который требуется сохранить или аккуратно вывести из эксплуатации.
- В колонке «Действия миграции» фиксируем точные шаги (какая транзакция или скрипт копирует данные, какие проверки выполняются).
- В колонке «Статус» отмечаем прогресс: `Запланировано`, `В работе`, `Готово`, `Не требуется` (для структур, которые не переносятся в новую архитектуру).
- Если структура заменяется несколькими новыми сущностями, добавляем несколько строк с одним и тем же «Старым ресурсом», но разными «Новыми ресурсами».
- При необходимости можно дополнять таблицу новыми колонками, но базовый формат сохраняем для сопоставимости между командами.

## 2. Таблица соответствий

| Старый пакет | Старый модуль | Старый ресурс/структура | Ключевые поля/описание | Новый пакет | Новый модуль | Новый ресурс/структура | Действия миграции | Статус |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| `lottery_core` | `core_rounds` | `RoundCollection` (resource) | Раунды, события, очередь историй | `lottery_data` | `rounds` | `RoundStore` (resource) | 1. Вызвать `lottery_data::migrate_rounds`<br>2. Сверить счётчики билетов | Запланировано |
| `lottery_core` | `core_treasury_multi` | `TreasuryState` (resource) | Балансы джекпота/операций, event handles | `lottery_data` | `treasury_multi` | `TreasuryState` (resource) | 1. Вызвать `lottery_data::migrate_multi_treasury`<br>2. Проверить соответствие долей | Запланировано |
| `lottery_multi` | `sales` | `LotterySaleConfig` (struct) | Конфигурация продаж, лимиты | `lottery_engine` | `sales` | `SaleConfig` (struct) | 1. Сконвертировать значения при деплое<br>2. Обновить хаб | Запланировано |
| `lottery_support` | `support_history` | `HistoryBridgeState` (resource) | Буфер историй для фронтенда | `lottery_utils` | `history` | `HistorySnapshot` (resource) | 1. Выполнить экспорт через скрипт `history_export`<br>2. Импортировать в новый ресурс | Запланировано |

> **Примерные значения** показаны только для ориентира. При реальном заполнении замените их фактическими именами структур и конкретными действиями миграции.

## 3. Журнал изменений

| Дата (UTC) | Изменение | Автор |
| --- | --- | --- |
| 2025-11-15 | Добавлен шаблон таблицы соответствий для планирования миграции. | Supra refactoring bot |
