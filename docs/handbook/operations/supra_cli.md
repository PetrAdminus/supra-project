# Supra CLI Рё Move-С‚РµСЃС‚С‹

Р”РѕРєСѓРјРµРЅС‚ РѕРїРёСЃС‹РІР°РµС‚ СѓСЃС‚Р°РЅРѕРІРєСѓ Supra Aptos CLI, РїСЂРѕРІРµСЂРєСѓ РѕРєСЂСѓР¶РµРЅРёСЏ Рё Р·Р°РїСѓСЃРє С‚РµСЃС‚РѕРІ `lottery_multi`.

## 1. РўСЂРµР±РѕРІР°РЅРёСЏ
- macOS 13+/Ubuntu 22.04+ СЃ СѓСЃС‚Р°РЅРѕРІР»РµРЅРЅС‹РјРё `curl`, `tar`, `openssl`.
- Р”РѕСЃС‚СѓРї Рє GitHub Releases Supra РґР»СЏ Р·Р°РіСЂСѓР·РєРё РіРѕС‚РѕРІС‹С… Р±РёРЅР°СЂРµР№ РёР»Рё Rust toolchain (РµСЃР»Рё С‚СЂРµР±СѓРµС‚СЃСЏ СЃР±РѕСЂРєР° РёР· РёСЃС…РѕРґРЅРёРєРѕРІ).
- РџСЂР°РІР° РЅР° Р·Р°РїРёСЃСЊ РІ РґРёСЂРµРєС‚РѕСЂРёСЋ `${HOME}/.local/bin` (РёР»Рё Р°Р»СЊС‚РµСЂРЅР°С‚РёРІРЅС‹Р№ РїСѓС‚СЊ СѓСЃС‚Р°РЅРѕРІРєРё).

## 2. РЈСЃС‚Р°РЅРѕРІРєР°
### 2.1 Р“РѕС‚РѕРІС‹Р№ Р±РёРЅР°СЂСЊ
1. Р—Р°РіСЂСѓР·РёС‚Рµ Р°СЂС…РёРІ СЃ РїРѕСЃР»РµРґРЅРёРј СЂРµР»РёР·РѕРј Supra CLI (`supra-aptos-cli-<os>-<arch>.tar.gz`).
2. Р Р°СЃРїР°РєСѓР№С‚Рµ Р°СЂС…РёРІ РІ РІСЂРµРјРµРЅРЅСѓСЋ РґРёСЂРµРєС‚РѕСЂРёСЋ: `tar -xzf supra-aptos-cli-*.tar.gz`.
3. РЎРєРѕРїРёСЂСѓР№С‚Рµ Р±РёРЅР°СЂСЊ РІ `${HOME}/.local/bin` (РёР»Рё Р»СЋР±РѕР№ РєР°С‚Р°Р»РѕРі РёР· `$PATH`):
   ```bash
   install -m 0755 supra-aptos-cli ${HOME}/.local/bin/aptos
   ```
4. РЈР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ РєР°С‚Р°Р»РѕРі РЅР°С…РѕРґРёС‚СЃСЏ РІ `$PATH`:
   ```bash
   export PATH="${HOME}/.local/bin:${PATH}"
   ```

### 2.2 РЎР±РѕСЂРєР° РёР· РёСЃС…РѕРґРЅРёРєРѕРІ
1. РЈСЃС‚Р°РЅРѕРІРёС‚Рµ nightly toolchain: `rustup toolchain install nightly`.
2. РЎРѕР±РµСЂРёС‚Рµ CLI:
   ```bash
   cargo +nightly install --git https://github.com/supraoracles/supra-aptos-cli aptos --locked
   ```
3. РџСЂРѕРІРµСЂСЊС‚Рµ, С‡С‚Рѕ `~/.cargo/bin` РґРѕР±Р°РІР»РµРЅ РІ `$PATH`.

## 3. РџСЂРѕРІРµСЂРєР° СѓСЃС‚Р°РЅРѕРІРєРё
1. Р’С‹РїРѕР»РЅРёС‚Рµ `aptos --version` Рё СѓР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ РІРµСЂСЃРёСЏ в‰Ґ 2.0.0-supra.
2. Р—Р°РїСѓСЃС‚РёС‚Рµ СЃРєСЂРёРїС‚ РїСЂРѕРІРµСЂРєРё:
   ```bash
   ./SupraLottery/supra/scripts/run_move_tests.sh --help
   ```
   РЎРєСЂРёРїС‚ РІР°Р»РёРґРёСЂСѓРµС‚ РЅР°Р»РёС‡РёРµ Р±РёРЅР°СЂСЏ (`APTOS_BIN` РјРѕР¶РµС‚ РїРµСЂРµРѕРїСЂРµРґРµР»РёС‚СЊ РїСѓС‚СЊ) Рё РїРѕРєР°Р¶РµС‚ СЃРёРЅС‚Р°РєСЃРёСЃ РєРѕРјР°РЅРґС‹.
3. Р”РѕР±Р°РІСЊС‚Рµ alias (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ):
   ```bash
   alias supra-aptos="APTOS_BIN=/opt/supra/bin/aptos ./SupraLottery/supra/scripts/run_move_tests.sh"
   ```

## 4. Р—Р°РїСѓСЃРє Move-С‚РµСЃС‚РѕРІ
- Р‘Р°Р·РѕРІС‹Р№ РїСЂРѕРіРѕРЅ РІСЃРµС… РїР°РєРµС‚РѕРІ:
  ```bash
  ./SupraLottery/supra/scripts/run_move_tests.sh
  ```
- РџСЂРѕРіРѕРЅ РєРѕРЅРєСЂРµС‚РЅРѕРіРѕ С‚РµСЃС‚Р°:
  ```bash
  ./SupraLottery/supra/scripts/run_move_tests.sh --filter payouts::force_cancel_refund_flow_records_history
  ```
- РџР°СЂР°Р»Р»РµР»СЊРЅС‹Р№ Р·Р°РїСѓСЃРє (Linux/macOS):
  ```bash
  ./SupraLottery/supra/scripts/run_move_tests.sh --threads 4
  ```

РЎРєСЂРёРїС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РёСЃРїРѕР»СЊР·СѓРµС‚ `SupraLottery/supra/move_workspace` РєР°Рє РґРёСЂРµРєС‚РѕСЂРёСЋ РїР°РєРµС‚Р° Рё Р·Р°РІРµСЂС€РёС‚СЃСЏ СЃ РєРѕРґРѕРј `127`, РµСЃР»Рё CLI РЅРµРґРѕСЃС‚СѓРїРµРЅ.

## 5. Р”РёР°РіРЅРѕСЃС‚РёРєР° РїСЂРѕР±Р»РµРј
| РЎРёРјРїС‚РѕРј | РџСЂРёС‡РёРЅР° | Р РµС€РµРЅРёРµ |
|---------|---------|---------|
| `command not found: aptos` | CLI РЅРµ СѓСЃС‚Р°РЅРѕРІР»РµРЅ РёР»Рё РЅРµ РІ `$PATH` | РЈСЃС‚Р°РЅРѕРІРёС‚СЊ CLI, РїСЂРѕРІРµСЂРёС‚СЊ РїРµСЂРµРјРµРЅРЅСѓСЋ `PATH`, РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ `APTOS_BIN=/abs/path` |
| `Failed to open package` | РќРµРІРµСЂРЅР°СЏ РґРёСЂРµРєС‚РѕСЂРёСЏ | РЈР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ СЂРµРїРѕР·РёС‚РѕСЂРёР№ СЃРёРЅС…СЂРѕРЅРёР·РёСЂРѕРІР°РЅ, `SupraLottery/supra/move_workspace` СЃСѓС‰РµСЃС‚РІСѓРµС‚ |
| `Move unit tests failed` | РћС€РёР±РєР° С‚РµСЃС‚РѕРІ/РєРѕРЅС‚СЂР°РєС‚РѕРІ | РћР·РЅР°РєРѕРјСЊС‚РµСЃСЊ СЃ Р»РѕРіР°РјРё, РІС‹РїРѕР»РЅРёС‚Рµ `aptos move prove` РїСЂРё РЅРµРѕР±С…РѕРґРёРјРѕСЃС‚Рё, Р·Р°РґРѕРєСѓРјРµРЅС‚РёСЂСѓР№С‚Рµ РёРЅС†РёРґРµРЅС‚ |

## 6. РРЅС‚РµРіСЂР°С†РёСЏ РІ CI/CD
- Job `move-tests` РґРѕР»Р¶РµРЅ РІС‹Р·С‹РІР°С‚СЊ `./SupraLottery/supra/scripts/run_move_tests.sh`.
- РЎРѕС…СЂР°РЅСЏР№С‚Рµ Р°СЂС‚РµС„Р°РєС‚С‹ `aptos_testsuite.log` Рё РґРѕР±Р°РІР»СЏР№С‚Рµ СЃСЃС‹Р»РєСѓ РІ СЂРµР»РёР·РЅСѓСЋ Р·Р°РїРёСЃСЊ.
- РџРµСЂРµРґ СЂРµР»РёР·РѕРј С„РёРєСЃРёСЂСѓР№С‚Рµ РёСЃРїРѕР»СЊР·СѓРµРјСѓСЋ РІРµСЂСЃРёСЋ CLI (`aptos --version`) РІ [Р¶СѓСЂРЅР°Р»Рµ РѕРїРµСЂР°С†РёР№](incident_log.md).

## 7. РЎРІСЏР·Р°РЅРЅС‹Рµ РјР°С‚РµСЂРёР°Р»С‹
- [РћРїРµСЂР°С†РёРѕРЅРЅС‹Рµ РїСЂРѕС†РµРґСѓСЂС‹](runbooks.md)
- [РџСЂРѕС†РµРґСѓСЂР° СЂРµС„Р°РЅРґР°](refund.md)
- [Р§РµРє-Р»РёСЃС‚ СЂРµР»РёР·Р°](release_checklist.md)
- [Р–СѓСЂРЅР°Р» РѕРїРµСЂР°С†РёР№](incident_log.md)

