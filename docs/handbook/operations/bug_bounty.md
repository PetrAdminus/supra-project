# Программа баг-баунти lottery_multi

## 1. Цели и зона охвата
- on-chain модули `lottery_multi::*` (кроме тестовых).
- Supra CLI-скрипты для dual-write и AutomationBot.
- Публичные view и JSON Schema `lottery_multi_views.schema.json`.
- Операционные runbook’и и релизные процедуры.

Вне зоны охвата: инфраструктура Supra (кластеры, сеть), фронтендовая монорепа и сторонние интеграции, если иное не указано в релизной записи.

## 2. Классификация уязвимостей и награды
| Уровень | Примеры | Базовая награда | Верхняя граница |
|---------|---------|-----------------|-----------------|
| **Критический** | Кража средств, нарушение выплат, обход `STATUS_FINALIZED`, манипуляция VRF | $20 000 | $75 000 (индивидуально, зависит от объёма затронутых средств и степени воспроизводимости) |
| **Высокий** | Блокировка продаж, нарушение инвариантов `Accounting`, несогласованность dual-write | $5 000 | $20 000 |
| **Средний** | Некорректные view, обход лимитов AutomationBot, DoS Automation | $1 000 | $5 000 |
| **Низкий** | Ошибки документации, некорректные события, уязвимости CLI | $250 | $1 000 / сувенирный набор |

> Финальная сумма зависит от качества отчёта, воспроизводимости, затронутой суммы и наличия PoC. Команда безопасности может присудить дополнительный бонус за комплексные находки, затрагивающие несколько компонентов.

### 2.1 Матрица соответствия активам
| Компонент | Критический | Высокий | Средний | Низкий |
|-----------|-------------|---------|---------|-------|
| On-chain `lottery_multi::*` | Да | Да | Да | Да |
| Supra CLI (`supra/scripts/*`) | Да (если ведёт к потере средств) | Да | Да | Да |
| JSON Schema / view | Да (при нарушении консистентности выплат или реестра) | Да | Да | Да |
| Операционные runbook’и | — | Да | Да | Да |
| Инфраструктура Supra (кластеры, сеть) | Нет (вне охвата) | Нет | Нет | Нет |

## 3. Процесс подачи отчётов
1. Отправить письмо на security@supra.xyz с темой `lottery_multi bug bounty`.
2. В теле письма указать:
   - шаги воспроизведения и окружение;
   - ожидаемое и фактическое поведение;
   - возможное влияние и требуемые права;
   - рекомендации по исправлению.
3. При необходимости зашифровать сообщение (PGP ключ — см. [security.md](../../security.md)).
4. Команда безопасности подтверждает получение в течение 48 часов.

## 4. SLA и процесс рассмотрения
- Триаж критических и высоких уязвимостей — 72 часа.
- Исправление критических уязвимостей — до 14 дней, высоких — до 30 дней.
- По завершении подготовить публичный отчёт, обновить `release_checklist.md` и `incident_log.md`.

### 4.1 Критерии принятия отчётов
- Отчёт должен содержать PoC или подробное описание, позволяющее воспроизвести проблему на devnet/staging.
- Дубликаты вознаграждаются только первому репортёру; повторные сообщения по уже закрытым уязвимостям не оплачиваются.
- Уязвимости, вызванные нарушением политики использования (например, социальная инженерия сотрудников), не оплачиваются.
- Наблюдения без реального влияния (`informational`) учитываются как низкий уровень и вознаграждаются сувенирным набором при наличии полезных рекомендаций.

### 4.2 Ограничения и исключения
- Атаки на физическую инфраструктуру или третий-party провайдеров (email, CDN, DNS) вне охвата.
- Тесты DoS должны проводиться исключительно в согласованном тестовом окружении; любые попытки перегрузки продуктивной сети запрещены.
- Самостоятельное удержание средств пользователей или их перевод без разрешения считается злоумышленным действием и дисквалифицирует репортёра.
- Извлечение данных, защищённых NDA, без согласования с Supra ведёт к дисквалификации.

## 5. Координация с релизами
- Перед релизом обновить перечень известных проблем и статус отчётов.
- В случае активных критических отчётов релиз блокируется до устранения.
- Изменения безопасности вносятся в раздел «Угроза» релизной записи.

## 6. Контакты
- **Security Lead:** А. Сергеев — @asecurity
- **On-chain Owner:** М. Ли — @mlottery
- **DevOps:** Н. Иванова — @ndevops

Все обновления программы публикуются в `docs/handbook/operations/incident_log.md` и релизных заметках.

## 7. Выплаты и учёт вознаграждений
- Выплаты производятся в USDT (ERC-20) или банковским переводом; предпочтительный канал указывается исследователем в ответном письме.
- Сбор KYC необходим для наград ≥ $10 000; обработка персональных данных проходит согласно политике Supra Privacy.
- Все выплаты фиксируются в `incident_log.md` с указанием ID отчёта, суммы и даты перевода; Security Lead подписывает запись.
- При выплате через криптовалюту Supra покрывает сетевые комиссии и отправляет транзакцию в течение 5 рабочих дней после согласования суммы.

## 8. Публичная коммуникация
- После закрытия критического или высокого отчёта мы публикуем краткий пост-мортем в `postmortems.md` и на статусной странице.
- Имя/псевдоним исследователя указывается только с его согласия.
- На ежеквартальном обзоре безопасности подводятся итоги программы, обновляется таблица наград и список активных инициатив.
