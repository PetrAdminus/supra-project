# Пострелизная поддержка lottery_multi

Этот документ описывает операционные активности после запуска lottery_multi. Он связывает мониторинг, статусную страницу, журнал
инцидентов и ретроспективы, чтобы команды могли отслеживать устойчивость платформы и выполнять SLA.

## 1. Ежедневные действия (D-ops)
- Проверить дашборд Grafana `Lottery Multi Ops` и статусную страницу: убедиться, что ключевые счётчики `status_overview` в зелёной зоне.
- Просмотреть Alertmanager и подтверждённые алёрты; каждое отклонение фиксируется через `supra/scripts/incident_log.sh`.
- Сверить показатели рефандов (`views::status_overview.refund_active`, `refund_batch_pending`, `refund_sla_breach`) с чек-листом [refund.md](refund.md) и убедиться, что SLA не нарушен.
- Подтвердить свежесть прайс-фида по метрикам `price_feed_updates_total`, `price_feed_clamp_active`, `price_feed_fallback_active`.
- Обновить раздел «Текущее состояние» на статусной странице, если выполнялись аварийные операции или релизные фиксации.

## 2. Еженедельная рутина
- Провести обзор инцидентного журнала: закрыть записи без постфактум-анализа и перенести невыполненные действия в план.
- Синхронизировать показатели с [monitoring.md](monitoring.md): при добавлении новых метрик обновить таблицу порогов и алёртов.
- Проверить срок действия `PartnerPayoutCap` и `PremiumAccessCap` через `roles::list_*`; истекающие записи продлить или отозвать.
- Обновить разделы [status_page.md](status_page.md) и [incident_log.md](incident_log.md) ссылками на проведённые работы.
- Подготовить краткую сводку для стейкхолдеров (Slack/Confluence) со ссылкой на журнал и статусную страницу.

## 3. Пост-инцидентные действия
1. Зафиксировать событие в [incident_log.md](incident_log.md) (CLI `supra/scripts/incident_log.sh`).
2. В течение 24 часов оформить отчёт по шаблону [postmortems.md](postmortems.md) и приложить ссылку в журнале.
3. Обновить мониторинг и статусную страницу: описать причину, масштаб и текущее состояние.
4. Внести корректировки в runbook’и (например, `runbooks.md`, `refund.md`, `vrf_deposit.md`), если в ходе инцидента выявлены пробелы.
5. Добавить задачи по предотвращению рецидивов в backlog; указать идентификаторы задач в разделе «Дальнейшие действия» отчёта.

## 4. SLA и отчётность
- **Инциденты уровня P1:** подтверждение ≤ 15 минут, решение ≤ 4 часов. Нарушения документируются в `postmortems.md` и отмечаются флагом `sla_breach` на статусной странице.
- **Рефанды:** см. [refund.md](refund.md). За каждый случай нарушения SLA добавлять запись в журнал и еженедельный отчёт.
- **VRF и AutomationBot:** при превышении `max_failures` или `vrf_retry_blocked > 0` более часа отчёт формируется автоматически и включается в ретроспективу недели.
- Отчётность хранится в общей папке `ops/reports/<YYYY-MM-DD>.md` (оформляется вне репозитория) и содержит ссылки на данный документ, журнал и мониторинг.

## 5. Ретроспективы и улучшения
- **Квартальная ретроспектива:** анализирует тренды алёртов, эффективность AutomationBot, экономику выплат. Итоги фиксируются в `postmortems.md` в разделе «Ретроспективы».
- **Обновление документации:** каждая ретроспектива проверяет, соответствуют ли фактические процессы описаниям в [lottery_multi_stage_playbook.md](../contracts/lottery_multi_stage_playbook.md) и [lottery_multi.md](../contracts/lottery_multi.md).
- **Roadmap:** результаты ретроспектив переносятся в `docs/architecture/lottery_parallel_plan.md` (раздел «Этап 6»), при необходимости создаются новые инициативы для governance/API.

## 6. Быстрая навигация
- Мониторинг: [monitoring.md](monitoring.md)
- Статусная страница: [status_page.md](status_page.md)
- Журнал: [incident_log.md](incident_log.md)
- Рефанды: [refund.md](refund.md)
- Ретроспективы: [postmortems.md](postmortems.md)
- План этапов: [../../architecture/lottery_parallel_plan.md](../../architecture/lottery_parallel_plan.md)
