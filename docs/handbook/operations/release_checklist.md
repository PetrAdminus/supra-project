# Р§РµРє-Р»РёСЃС‚ СЂРµР»РёР·Р° lottery_multi

> Р”РѕРєСѓРјРµРЅС‚ РїСЂРёРјРµРЅСЏРµС‚СЃСЏ РґР»СЏ СЂРµР»РёР·РѕРІ on-chain РєРѕРјРїРѕРЅРµРЅС‚РѕРІ `lottery_multi` РЅР° С‚РµСЃС‚РѕРІС‹Рµ Рё Р±РѕРµРІС‹Рµ РѕРєСЂСѓР¶РµРЅРёСЏ. РћС‚РІРµС‚СЃС‚РІРµРЅРЅС‹Рµ Р»РёС†Р° РїРѕРґРїРёСЃС‹РІР°СЋС‚СЃСЏ РїРѕРґ РєР°Р¶РґРѕР№ РѕС‚РјРµС‚РєРѕР№.

## 1. РџРѕРґРіРѕС‚РѕРІРєР° (T-3 РґРЅСЏ)
- [ ] РџРѕРґС‚РІРµСЂРґРёС‚СЊ, С‡С‚Рѕ РІСЃРµ Р·Р°РґР°С‡Рё СЌС‚Р°РїРѕРІ 3вЂ“5 Р·Р°РєСЂС‹С‚С‹ РІ `docs/architecture/lottery_multi_readiness_review.md`.
- [ ] РџСЂРѕРІРµСЂРёС‚СЊ РѕС‚СЃСѓС‚СЃС‚РІРёРµ РЅРµР·Р°РїР»Р°РЅРёСЂРѕРІР°РЅРЅС‹С… РјРёРіСЂР°С†РёР№ РІ `docs/architecture/rfc_v1_implementation_notes.md`.
- [ ] РЎРІРµСЂРёС‚СЊ Р°РєС‚СѓР°Р»СЊРЅРѕСЃС‚СЊ РїСЂРѕРіСЂР°РјРјС‹ Р±Р°Рі-Р±Р°СѓРЅС‚Рё: С‚Р°Р±Р»РёС†Р° РЅР°РіСЂР°Рґ Рё РјР°С‚СЂРёС†Р° РѕС…РІР°С‚Р° РІ [bug_bounty.md](bug_bounty.md) СЃРѕРІРїР°РґР°СЋС‚ СЃ СЃРѕРіР»Р°СЃРѕРІР°РЅРЅРѕР№ РІРµСЂСЃРёРµР№ Security.
- [ ] РЎРѕРіР»Р°СЃРѕРІР°С‚СЊ РѕРєРЅРѕ СЂРµР»РёР·Р° СЃ DevOps Рё РїРѕРґРґРµСЂР¶РєРѕР№, Р·Р°С„РёРєСЃРёСЂРѕРІР°С‚СЊ РІ `incident_log.md` (CLI `SupraLottery/supra/scripts/incident_log.sh --type "Р РµР»РёР·" ...`).
- [ ] РЈР±РµРґРёС‚СЊСЃСЏ, С‡С‚Рѕ `automation::ensure_action` Рё runbook Р±РѕС‚Р° Р°РєС‚СѓР°Р»РёР·РёСЂРѕРІР°РЅС‹; dry-run Р·Р°РїР»Р°РЅРёСЂРѕРІР°РЅ.
- [ ] РџСЂРѕРІРµСЃС‚Рё РєРѕРЅС‚СЂРѕР»СЊРЅРѕРµ С‡С‚РµРЅРёРµ `lottery_multi_views.schema.json` Рё РїСЂРёРјРµСЂРѕРІ `lottery_multi_view_samples.json`.

## 2. Р—Р°РјРѕСЂРѕР·РєР° Рё СЃР±РѕСЂ Р°СЂС‚РµС„Р°РєС‚РѕРІ (T-1 РґРµРЅСЊ)
- [ ] РћР±РЅРѕРІРёС‚СЊ `config_version` РІ `registry::config` Рё Р·Р°РїРёСЃР°С‚СЊ Р·РЅР°С‡РµРЅРёРµ РІ Р¶СѓСЂРЅР°Р» (`SupraLottery/supra/scripts/incident_log.sh --type "Р РµР»РёР·" ...`).
- [ ] РЎРѕР·РґР°С‚СЊ git-С‚РµРі `lottery_multi-release-<date>` Рё РїСЂРёР»РѕР¶РёС‚СЊ РµРіРѕ Рє СЂРµР»РёР·РЅРѕР№ Р·Р°РїРёСЃРё.
- [ ] РЎС„РѕСЂРјРёСЂРѕРІР°С‚СЊ СЃРїРёСЃРѕРє РјРёРіСЂР°С†РёР№/СЃРєСЂРёРїС‚РѕРІ (`SupraLottery/supra/scripts/*.sh`) Рё РїРѕРґС‚РІРµСЂРґРёС‚СЊ РёС… РІС‹РїРѕР»РЅРёРјРѕСЃС‚СЊ Р±РµР· CLI-РѕС€РёР±РѕРє (dry-run), РІРєР»СЋС‡Р°СЏ `refund_control.sh` (`cancel`, `batch`, `progress`, `archive`).
- [ ] РџСЂРѕРіРЅР°С‚СЊ `history_backfill.sh dry-run <summary>` (СЃ `--json --quiet --json-output <file>`) РґР»СЏ РІСЃРµС… РїРѕРґРіРѕС‚РѕРІР»РµРЅРЅС‹С… СЃРІРѕРґРѕРє, СЃРѕС…СЂР°РЅРёС‚СЊ hex/С…СЌС€Рё Рё JSON-Р°СЂС‚РµС„Р°РєС‚С‹ Рё РїСЂРёР»РѕР¶РёС‚СЊ РёС… Рє Р¶СѓСЂРЅР°Р»Сѓ РјРёРіСЂР°С†РёРё (`incident_log.sh --type "Backfill" ...`).
- [ ] Р—Р°С„РёРєСЃРёСЂРѕРІР°С‚СЊ РєРѕРЅС‚СЂРѕР»СЊРЅС‹Рµ С…СЌС€Рё dual-write С‡РµСЂРµР· `dual_write_control.sh status` Рё РѕР±РЅРѕРІРёС‚СЊ Р¶СѓСЂРЅР°Р» (`incident_log.sh --type "РРЅС†РёРґРµРЅС‚" ...`).
- [ ] РџСЂРѕРІРµСЂРёС‚СЊ СЃРѕСЃС‚РѕСЏРЅРёРµ РїСЂР°Р№СЃ-С„РёРґРѕРІ: `price_feed::get_price_view` РїРѕ Р°РєС‚РёРІРЅС‹Рј `asset_id`, РѕС‚СЃСѓС‚СЃС‚РІРёРµ `clamp_active`/`fallback_active`, РїРѕСЃР»РµРґРЅРµРµ СЃРѕР±С‹С‚РёРµ `PriceFeedClampClearedEvent` Р·Р°С„РёРєСЃРёСЂРѕРІР°РЅРѕ РІ Р¶СѓСЂРЅР°Р»Рµ (`incident_log.sh --type "РРЅС†РёРґРµРЅС‚" ...`).
- [ ] Р—Р°С„РёРєСЃРёСЂРѕРІР°С‚СЊ СЃРѕСЃС‚РѕСЏРЅРёРµ AutomationBot С‡РµСЂРµР· `./SupraLottery/supra/scripts/automation_status.sh <config> list` Рё РїСЂРё РЅРµРѕР±С…РѕРґРёРјРѕСЃС‚Рё `get <operator>`: РїРѕРґС‚РІРµСЂРґРёС‚СЊ РєРѕСЂСЂРµРєС‚РЅРѕСЃС‚СЊ `has_pending`, `pending_execute_after`, `failure_count`/`max_failures`; РѕР±РЅРѕРІРёС‚СЊ Р·Р°РјРµС‚РєСѓ СЃС‚Р°С‚СѓСЃРЅРѕР№ СЃС‚СЂР°РЅРёС†С‹ РїСЂРё РѕС‚РєР»РѕРЅРµРЅРёСЏС….
- [ ] РџСЂРѕРІРµСЂРёС‚СЊ, С‡С‚Рѕ РґР»СЏ Р±РѕС‚РѕРІ СЃ РґРµР№СЃС‚РІРёСЏРјРё `ACTION_UNPAUSE`/`ACTION_PAYOUT_BATCH`/`ACTION_CANCEL` С‚Р°Р№РјР»РѕРє в‰Ґ 900 СЃРµРєСѓРЅРґ (С‡РµСЂРµР· `automation_status.sh` РёР»Рё РґР°С€Р±РѕСЂРґ `automation_timelock_breach = 0`); РїСЂРё РЅР°СЂСѓС€РµРЅРёРё РѕР±РЅРѕРІРёС‚СЊ РєРѕРЅС„РёРіСѓСЂР°С†РёСЋ Рё Р·Р°РґРѕРєСѓРјРµРЅС‚РёСЂРѕРІР°С‚СЊ СЂРµС€РµРЅРёРµ РІ Р¶СѓСЂРЅР°Р»Рµ.
- [ ] Р’С‹РіСЂСѓР·РёС‚СЊ СЃРїРёСЃРѕРє СЂРѕР»РµР№ С‡РµСЂРµР· `roles::list_partner_caps` Рё `roles::list_premium_caps`, РїСЂРѕРІРµСЂРёС‚СЊ РѕСЃС‚Р°С‚РєРё/expiry Рё Р·Р°РґРѕРєСѓРјРµРЅС‚РёСЂРѕРІР°С‚СЊ РЅРµРѕР±С…РѕРґРёРјС‹Рµ `cleanup_expired_admin`/`revoke_*` РѕРїРµСЂР°С†РёРё РІ `incident_log.md` (С‡РµСЂРµР· `incident_log.sh`).
- [ ] РЈР±РµРґРёС‚СЊСЃСЏ, С‡С‚Рѕ РїР»Р°РЅ РєРѕРјРјСѓРЅРёРєР°С†РёР№ РЅР° СЃР»СѓС‡Р°Р№ РѕС‚РјРµРЅС‹ Р»РѕС‚РµСЂРµР№ Р°РєС‚СѓР°Р»РµРЅ: РѕР±РЅРѕРІРёС‚СЊ С€Р°Р±Р»РѕРЅС‹ СѓРІРµРґРѕРјР»РµРЅРёР№ Рё РєРѕРЅС‚Р°РєС‚РЅС‹Рµ С‚РѕС‡РєРё РІ [refund.md](refund.md) Рё СЃРѕРіР»Р°СЃРѕРІР°С‚СЊ СЃ РїРѕРґРґРµСЂР¶РєРѕР№.
- [ ] РџСЂРѕРІРµСЂРёС‚СЊ РіРѕС‚РѕРІРЅРѕСЃС‚СЊ С„СЂРѕРЅС‚РµРЅРґ- Рё РёРЅРґРµРєСЃР°С‚РѕСЂРЅС‹С… РєРѕРјР°РЅРґ.

## 3. РћРєРЅРѕ СЂРµР»РёР·Р° (T0)
- [ ] Р’С‹РїРѕР»РЅРёС‚СЊ РјРёРіСЂР°С†РёРё (РµСЃР»Рё РµСЃС‚СЊ) Рё РѕР±РЅРѕРІР»РµРЅРёСЏ РјРѕРґСѓР»РµР№ Move.
- [ ] Р—Р°РїСѓСЃС‚РёС‚СЊ smoke-С‚РµСЃС‚С‹: `./SupraLottery/supra/scripts/run_move_tests.sh` (РёР»Рё `APTOS_BIN=<path> ./SupraLottery/supra/scripts/run_move_tests.sh`) Рё `pytest tests/test_view_schema_examples.py`.
- [ ] Р’РєР»СЋС‡РёС‚СЊ РѕР±РЅРѕРІР»С‘РЅРЅС‹Рµ С„Р»Р°РіРё feature-switch Рё РїРѕРґС‚РІРµСЂРґРёС‚СЊ СЃРѕР±С‹С‚РёСЏ `FeatureSwitchUpdated`.
- [ ] РњРѕРЅРёС‚РѕСЂРёС‚СЊ `ArchiveDualWrite*`, `Automation*`, `Vrf*` СЃРѕР±С‹С‚РёСЏ РІ СЂРµР°Р»СЊРЅРѕРј РІСЂРµРјРµРЅРё.
- [ ] РџСЂРёРѕСЃС‚Р°РЅРѕРІРёС‚СЊ РїСЂРѕРґР°Р¶Рё РїСЂРё РєСЂРёС‚РёС‡РµСЃРєРёС… Р°Р»РµСЂС‚Р°С…, Р·Р°РґРѕРєСѓРјРµРЅС‚РёСЂРѕРІР°С‚СЊ РґРµР№СЃС‚РІРёСЏ.

## 4. РџРѕСЃС‚-СЂРµР»РёР· (T+1 РґРµРЅСЊ)
- [ ] РџСЂРѕРІРµСЃС‚Рё СЃРІРµСЂРєСѓ Р°РіСЂРµРіР°С‚РѕРІ `Accounting` Рё `LotterySummary` РїРѕ РєРѕРЅС‚СЂРѕР»СЊРЅС‹Рј Р»РѕС‚РµСЂРµСЏРј СЃ РїРѕРјРѕС‰СЊСЋ `./SupraLottery/supra/scripts/accounting_check.sh <config> compare <lottery_id>`; СЃРѕС…СЂР°РЅРёС‚СЊ JSON-РѕС‚С‡С‘С‚ РІ `incident_log.md`.
- [ ] РџСЂРѕРІРµСЂРёС‚СЊ `views::status_overview` Рё `views::list_automation_bots`, РѕР±РЅРѕРІРёС‚СЊ [СЃС‚Р°С‚СѓСЃРЅСѓСЋ СЃС‚СЂР°РЅРёС†Сѓ](status_page.md); РїСЂРё РѕР±РЅР°СЂСѓР¶РµРЅРёРё `vrf_retry_blocked`/`payout_backlog`/`refund_sla_breach`/`refund_batch_pending > 0` > 4С‡/`has_pending = true` РґРѕР»СЊС€Рµ С‚Р°Р№РјР»РѕРєР° РІС‹РїРѕР»РЅРёС‚СЊ С€Р°РіРё РёР· [monitoring.md](monitoring.md).
- [ ] РћР±РЅРѕРІРёС‚СЊ `docs/handbook/contracts/lottery_multi.md` Рё runbookвЂ™Рё, РµСЃР»Рё РїРѕСЏРІРёР»РёСЃСЊ РЅРѕРІС‹Рµ С€Р°РіРё.
- [ ] РџРѕРґРіРѕС‚РѕРІРёС‚СЊ РїСѓР±Р»РёС‡РЅСѓСЋ Р·Р°РјРµС‚РєСѓ РІ Р±Р°Рі-Р±Р°СѓРЅС‚Рё-РїСЂРѕРіСЂР°РјРјРµ РїСЂРё РёР·РјРµРЅРµРЅРёРё СѓРіСЂРѕР·/РїРѕРІРµРґРµРЅРёСЏ.
- [ ] Р—Р°С„РёРєСЃРёСЂРѕРІР°С‚СЊ СЂРµР·СѓР»СЊС‚Р°С‚С‹ smoke-С‚РµСЃС‚РѕРІ Рё РјРѕРЅРёС‚РѕСЂРёРЅРіР° РІ `incident_log.md` (`incident_log.sh --type "Dry-run" ...`).
- [ ] Р—Р°РїСѓСЃС‚РёС‚СЊ СЂРµС‚СЂРѕСЃРїРµРєС‚РёРІСѓ СЃ СѓС‡Р°СЃС‚РёРµРј DevOps, РїСЂРѕРґСѓРєС‚РѕРІРѕР№ Рё РїРѕРґРґРµСЂР¶РєРё.
- [ ] РћР±РЅРѕРІРёС‚СЊ [post_release_support.md](post_release_support.md) (РµР¶РµРґРЅРµРІРЅС‹Р№ Рё РµР¶РµРЅРµРґРµР»СЊРЅС‹Р№ РїР»Р°РЅ) Рё СЃРѕР·РґР°С‚СЊ Р·Р°РїРёСЃСЊ РІ [postmortems.md](postmortems.md) СЃ РёС‚РѕРіР°РјРё СЂРµР»РёР·Р°.

## 5. Р РµР»РёР·РЅР°СЏ Р·Р°РїРёСЃСЊ
- РЎСЃС‹Р»РєР° РЅР° PR: ____
- РҐСЌС€ СЂРµРІРёР·РёРё: ____
- РљРѕРЅС„РёРіСѓСЂР°С†РёСЏ `config_version`: ____
- Р”Р°С‚Р° Рё РІСЂРµРјСЏ СЂРµР»РёР·Р°: ____
- РћС‚РІРµС‚СЃС‚РІРµРЅРЅС‹Рµ: ____

## 6. РљРѕРЅС‚СЂРѕР»СЊРЅС‹Р№ СЃРїРёСЃРѕРє РѕС‚РєР°С‚Р°
- [ ] РџСЂРѕРІРµСЂРёС‚СЊ РґРѕСЃС‚СѓРїРЅРѕСЃС‚СЊ СЂРµР·РµСЂРІРЅРѕР№ РІРµСЂСЃРёРё РїР°РєРµС‚РѕРІ.
- [ ] РџРѕРґРіРѕС‚РѕРІРёС‚СЊ СЃРєСЂРёРїС‚С‹ `disable-mirror`, `clear-expected-hash` РґР»СЏ dual-write.
- [ ] Р—Р°РґРѕРєСѓРјРµРЅС‚РёСЂРѕРІР°С‚СЊ РґРµР№СЃС‚РІРёСЏ РїРѕ РѕС‚РєР°С‚Сѓ РІ runbook Рё РѕРїРѕРІРµСЃС‚РёС‚СЊ Р·Р°РёРЅС‚РµСЂРµСЃРѕРІР°РЅРЅС‹С… Р»РёС†.

