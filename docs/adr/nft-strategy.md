# ADR: Стратегия NFT-бейджей Supra Lottery

## Контекст
Мульти-лотерейная архитектура требует способа отмечать победителей уникальными трофеями, которые можно отображать в профиле, шарить в соцсетях и использовать как доказательство победы. Первоначальный план предусматривал "уникальный NFT-идентификатор" и интеграцию с внешними коллекциями (например, Crystara), однако в кодовой базе отсутствовал on-chain механизм выпуска наград и учёта их владения.

## Решение
1. **Встроенный выпуск бейджей в Move.** Добавлен модуль `lottery_rewards::nft_rewards`, размещённый под адресом @lottery. Он хранит глобальное состояние (администратор, счётчик бейджей, таблица коллекций пользователей), генерирует события `BadgeMintedEvent`/`BadgeBurnedEvent` и предоставляет view-функции `has_badge`, `list_badges`, `get_badge` для оффчейн-сервисов.
2. **Метаданные и привязка к розыгрышу.** Каждая запись (`WinnerBadgeData`) фиксирует `badge_id`, `lottery_id`, `draw_id`, `metadata_uri` (например, IPFS с изображением) и адрес минтера. Этого достаточно, чтобы фронтенд и панель честности сопоставляли бейдж с конкретным розыгрышем и визуалом.
3. **Контроль доступа.** `mint_badge` доступна только администратору (по умолчанию @lottery); `burn_badge` может вызвать администратор или владелец бейджа. Таким образом, команда может отозвать ошибочный трофей, а пользователь — скрыть его при желании.
4. **Unit-тесты.** Тесты `lottery_rewards/tests/nft_rewards_tests.move` подтверждают успешный выпуск, невозможность минта неадминистратором и ручное сжигание владельцем. Это фиксирует контрактный интерфейс до интеграции с фронтендом.
5. **Интеграция с внешними NFT.** План остаётся открыть поддержку внешних коллекций (Crystara) через off-chain синхронизацию. Для этого будет построен сервис агрегации метаданных, который объединит внутренние бейджи и внешние NFT в профиле пользователя.

## Последствия
- Лотерея получает on-chain подтверждение победы без ожидания внешних партнёров.
- Панель честности и API могут воспроизводить историю наград по событиям и view-функциям.
- Фронтенд сможет отображать бейджи в профиле сразу после интеграции дизайн-системы, не меняя контракт.
- Поддержка внешних коллекций остаётся в планах, но теперь есть базовая реализация, которую можно расширять.
