# Пояснение к логу ошибки Move workflow

Ниже разобраны ключевые сообщения из лога и что они означают.

## 1. `Run set -euo pipefail`
Этот вывод показывает, что шаг GitHub Actions запускается в режиме строгой обработки ошибок. Параметры оболочки:
- `-e` останавливает скрипт при первой ошибке.
- `-u` запрещает использование необъявленных переменных.
- `-o pipefail` заставляет конвейер команд возвращать код ошибки, если сбой произошёл в любой из команд.

## 2. Инъекция именованных адресов
```
[move-test] Injecting named addresses from .../.move/config: jackpot_pool=0x... , ... , vrf_hub=0x...
```
Система тестирования читает файл `.move/config` и подставляет перечисленные адреса (например, `jackpot_pool`, `lottery`, `player1` и т.д.) в пакет Move. Эти адреса нужны, чтобы скомпилировать смарт-контракты с правильными значениями аккаунтов.

## 3. Команда компиляции Aptos CLI
```
/usr/local/bin/aptos move compile --package-dir ... --named-addresses ...
```
Workflow пытается скомпилировать пакет Move (`lottery`) с помощью утилиты `aptos`. Путь `--package-dir` указывает на директорию проекта, а опция `--named-addresses` передаёт адреса из предыдущего шага.

## 4. Загрузка зависимостей
```
Compiling, may take a little while to download git dependencies...
FETCHING GIT DEPENDENCY https://github.com/Entropy-Foundation/aptos-core.git
INCLUDING DEPENDENCY ...
```
Во время компиляции Move может подтянуть внешние зависимости (стандартные библиотеки, фреймворки Supra и т.д.). Это нормальный процесс при первой сборке или если зависимости ещё не кешированы.

## 5. Ошибки компиляции `error[E01002]: unexpected token`
Лог перечисляет несколько файлов из зависимости `aptos-core`, где компилятор Move не смог разобрать конструкции вида `for (i in 0..n) { ... }`. Сообщение `Expected ')'` означает, что синтаксис цикла с оператором `in` не поддерживается установленной версией компилятора.

### Почему это происходит
В репозитории Supra используется ветка `dev` `aptos-core`, в которой уже есть современный синтаксис циклов `for ... in ...`. Однако текущий бинарник `aptos` в GitHub Actions (версия Move компилятора) ещё не умеет такой синтаксис. Поэтому компилятор падает, считая `in` неожиданным токеном.

### Последствие
Из-за этих синтаксических несоответствий сборка пакета `lottery` завершается ошибкой, и шаг workflow возвращает код `1`, что прерывает pipeline.

## 6. Итоговое сообщение
```
{"Error": "Move compilation failed: Compilation error"}
Error: Process completed with exit code 1.
```
Сборка завершилась неудачно, GitHub Actions фиксирует ошибку и помечает весь workflow как упавший.

## Что можно сделать
- Обновить бинарник `aptos`/Move компилятор до версии, поддерживающей новый синтаксис `for ... in ...`.
- Либо зафиксировать зависимости на версии, совместимой с текущим компилятором.

До тех пор, пока версии инструментария и зависимостей не совпадают по синтаксису, сборка будет продолжать падать на этих строках.
