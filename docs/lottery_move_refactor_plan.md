# План миграции модулей лотереи к шаблонам Supra-Labs

## Этап 1. Подготовка общих утилит
- [ ] Создать модуль с проверяемыми арифметическими функциями (замена `std::math64`).
- [ ] Добавить обёртку для генерации событий через `event::emit` без хранения `EventHandle`.

## Этап 2. Рефакторинг доменных модулей
- [ ] Store: перевести события и снапшоты на новые утилиты, убрать `&*state`.
- [ ] NftRewards: внедрить `events::emit`, заменить `math64`, переработать снапшоты.
- [ ] Referrals: использовать общие хелперы, раскрыть необходимые `public(friend)` функции.
- [ ] Jackpot: перейти на новые события и арифметику, обновить хелперы.
- [ ] LotteryInstances: устранить `EventHandle`, переписать сборщики снапшотов.
- [ ] Vip: обновить подписки и view-функции, убрать доступ к приватным структурам.
- [ ] Autopurchase: адаптировать таблицы планов и снапшоты.
- [ ] History: привести сборщикам Snapshots, убрать `borrow::freeze`.
- [ ] LotteryRounds: заменить `math64`, обновить тестовые хелперы и события.
- [ ] Treasury и TreasuryMulti: синхронизировать friend-доступ и арифметику.
- [ ] Migration и LotteryFactory: обновить вызовы событий и зависимостей.

## Этап 3. Обновление тестов
- [ ] Привести модульные тесты к новым сигнатурам снапшотов.
- [ ] Заменить деструктуризацию приватных структур на публичные getter'ы.

## Этап 4. Верификация
- [ ] Запустить `move tool test` для пакета `lottery` в среде с Supra CLI.
- [ ] При необходимости дополнительно проверить `lottery_factory` и `vrf_hub`.

> План основан на официальных примерах Supra-Labs; после завершения каждого блока необходимо сверяться с актуальными шаблонами в открытых репозиториях Supra.
