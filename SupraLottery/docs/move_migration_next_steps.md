# Следующие шаги по миграции Move 1

Ниже перечислены предложения, которые помогут завершить перевод Supra Lottery на Move 1 и сделать пакеты независимыми друг от друга.

## 1. Унифицировать события и инициализацию ресурсов
- ✅ Вынесена вспомогательная функция `events::new_handle` в отдельный модуль, инициализирующий обработчики событий для всех подсистем лотереи. Благодаря этому код `init` теперь использует единый вызов без прямого обращения к `account::new_event_handle`, что упростит адаптацию к будущим изменениям Supra Framework и снизит дублирование в `Autopurchase`, `Rounds`, `TreasuryMulti`, `Vip` и других модулях.【F:SupraLottery/supra/move_workspace/lottery/sources/Events.move†L1-L14】【F:SupraLottery/supra/move_workspace/lottery/sources/Autopurchase.move†L122-L130】【F:SupraLottery/supra/move_workspace/lottery/sources/TreasuryMulti.move†L171-L183】
- ✅ Функции ядра переведены на `public(package)`, и лишние `friend`-директивы удалены: теперь пакет не требует доверенных модулей даже для тестов. Следующий шаг — добавить автоматические прогонки `move check`/`move test` для автономных пакетов, чтобы гарантировать сохранение ограничений доступа после изменений видимости.【F:SupraLottery/supra/move_workspace/lottery/sources/Treasury.move†L1-L9】【F:SupraLottery/supra/move_workspace/lottery/sources/Lottery.move†L1-L6】
- ✅ Добавлены обёртки `events::emit`/`events::emit_copy`, которые инкапсулируют `event::emit_event` и позволяют сокращать повторяющийся код при публикации снимков и административных действий. Теперь модули лотереи используют единый интерфейс как для создания обработчиков событий, так и для их отправки.【F:SupraLottery/supra/move_workspace/lottery/sources/Events.move†L15-L27】【F:SupraLottery/supra/move_workspace/lottery/sources/Autopurchase.move†L176-L185】【F:SupraLottery/supra/move_workspace/lottery/sources/LotteryInstances.move†L169-L207】
- ✅ Фабрика лотерей и VRF-хаб получили аналогичные модули `events`, так что все пакеты воркспейса инициализируют и публикуют события через единый слой абстракции, не обращаясь напрямую к `account::new_event_handle` или `event::emit_event`. Это облегчает сопровождение и предотвращает расхождения между пакетами при будущих изменениях Supra Framework.【F:SupraLottery/supra/move_workspace/lottery_factory/sources/Events.move†L1-L27】【F:SupraLottery/supra/move_workspace/lottery_factory/sources/LotteryFactory.move†L40-L47】【F:SupraLottery/supra/move_workspace/vrf_hub/sources/Events.move†L1-L22】【F:SupraLottery/supra/move_workspace/vrf_hub/sources/VRFHub.move†L11-L20】

## 2. Упростить структуру воркспейса
- ✅ Удалены устаревшие копии пакетов из `tmp/move_workspace_copy`, теперь поддерживаются только каноничные исходники в `SupraLottery/supra/move_workspace` и `supra/move_workspace`.
- ✅ `Move.toml` пакета лотереи синхронизированы между `SupraLottery/supra/move_workspace` и `supra/move_workspace`: обе версии подключают `SupraFramework`, `vrf_hub`, `lottery_factory`, `SupraVrf` и используют единый набор адресов с выносом тестовых значений в `[dev-addresses]`. Теперь локальный воркспейс `supra/` ссылается на эталонные пакеты из `SupraLottery/`, устраняя дублирование конфигурации и зависимостей.【F:SupraLottery/supra/move_workspace/lottery/Move.toml†L1-L28】【F:supra/move_workspace/lottery/Move.toml†L1-L31】

## 3. Автоматизировать тесты
- ✅ Скрипт `SupraLottery/supra/scripts/move_tests.py` автоматически подбирает формат аргумента пакета (`--package-dir` для Supra/Aptos, `--package` для vanilla Move) и поддерживает режим `--mode check`, позволяя запускать как тесты, так и статические проверки для отдельных пакетов (`lottery`, `vrf_hub` и т.д.) без обходных путей.【F:SupraLottery/supra/scripts/move_tests.py†L90-L162】
- Настроить GitHub Actions или локальный `make`-скрипт, проверяющий все пакеты (`lottery`, `lottery_factory`, `vrf_hub`, `SupraVrf`) отдельно, чтобы быстрее ловить регрессии.【F:SupraLottery/supra/scripts/move_tests.py†L94-L162】

## 4. Документировать обновлённый пайплайн
- ✅ README содержит раздел о переходе на Move 1, едином модуле событий и пример вызова `move-test` с переключением CLI.【F:README.md†L122-L170】
- ✅ В руководства добавлены подсказки по переопределению адресов (`--override-addresses`) и использованию `.move/config` для повторяемых прогонов без правки `Move.toml`. Блок присутствует и в корневом README, и в `SupraLottery/README.md` для разработчиков воркспейса.【F:README.md†L147-L156】【F:SupraLottery/README.md†L54-L60】
- Добавить в репозиторий шаблон `.move/config.example` с комментариями по адресам тестовой/боевой сети, чтобы новые участники могли скопировать файл без обращения к документации.
